<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><title>Node.js开发博客项目（一） | MUMU'S BLOG</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="bbgirl"><meta name="designer" content="minfive"><meta name="keywords" content="minfive, minfive blog, 前端博客, 前端, 程序员, 前端开发, 全栈开发, node.js, javascript"><meta name="description" content="日常学习与兴趣交流的个人博客。"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="http://yoursite.com/2019/04/29/hello-nodejs1/index.html"><link rel="icon" type="image/png" href="undefined" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="MUMU"><link rel="stylesheet" href="/scss/views/page/post.css"></head><body ontouchstart><div id="page-loading" class="page page-loading" style="background-image:url(https://blog.static.minfive.com/other/loader.gif)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="MUMU" alt="MUMU"><img src="/img/logo.jpg" alt="MUMU"></a><nav class="page__nav"><ul class="nav__list clearfix"><li class="nav__item"><a href="/" alt="首页" title="首页">首页</a></li><li class="nav__item"><a href="/archives" alt="归档" title="归档">归档</a></li><li class="nav__item"><a href="/music" alt="音乐" title="音乐">音乐</a></li><li class="nav__item"><a href="/english" alt="每日一句" title="每日一句">每日一句</a></li><li class="nav__item"><a href="/about" alt="关于" title="关于">关于</a></li></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><div class="post__cover"><img src="/img/nodejs.png" alt="Node.js开发博客项目（一）"></div><header class="post__info"><h1 class="post__title">Node.js开发博客项目（一）</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="https://www.github.com/BruceYuj">Mumu</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2019-04-29</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/Node-js/">Node.js</a></li></ul></div></div></header><div class="post__content"><h2 id="1-1-Node-js-的真正用途"><a href="#1-1-Node-js-的真正用途" class="headerlink" title="1.1 Node.js 的真正用途"></a>1.1 Node.js 的真正用途</h2><blockquote><ul><li>Nodejs，一个javascript运行环境</li><li><code>运行在服务器，作为web server</code></li><li>运行在本地，作为打包和构建工具</li></ul></blockquote><h2 id="1-2-内容概述"><a href="#1-2-内容概述" class="headerlink" title="1.2 内容概述"></a>1.2 内容概述</h2><blockquote><ul><li>做什么？——nodejs入门到实践，开发个人博客系统</li><li>哪些部分？——API，数据存储，登录，日志，安全</li><li>技术？——http stream session mysql redis nginx pm2 …</li></ul></blockquote><h2 id="1-3-案例架构"><a href="#1-3-案例架构" class="headerlink" title="1.3 案例架构"></a>1.3 案例架构</h2><p><img src="/img/anli_jiagou.jpg" alt="图片alt"></p><h2 id="2-1-Nodejs-介绍"><a href="#2-1-Nodejs-介绍" class="headerlink" title="2.1 Nodejs 介绍"></a>2.1 Nodejs 介绍</h2><p><strong>1）下载 &amp; 安装</strong></p><blockquote><ol><li>普通安装（只有一个版本，不能随意切换），访问<a href="http://nodejs.cn/" target="_blank" rel="noopener">官网</a>,下载并安装；完了打开命令行，运行<code>node -v</code>和<code>npm -v</code>测试。</li><li>使用NVM（Node Version Manager）<ul><li>Nodejs版本管理工具，可切换多个Nodejs版本</li><li>mac os，使用<code>brew install nvm</code>(<a href="https://brew.sh/" target="_blank" rel="noopener">brew</a>是苹果的软件管理工具)</li><li>windows，github中搜索nvm-windows，有下载地址</li><li><code>nvm list</code>，查看当前所有的node版本</li><li><code>nvm install v10.15.0</code>，安装指定版本</li><li><code>nvm use --delete-prefix 8.12.0</code>，切换到指定版本</li></ul></li></ol></blockquote><p><strong>2）nodejs和前端javascript的区别？</strong></p><blockquote><ol><li>ECMAScript，具体可见<a href="http://es6.ruanyifeng.com/" target="_blank" rel="noopener">阮一峰的ES6</a><ul><li>定义了语法，写javascript和nodejs都必须遵守</li><li>变量定义，循环、判断、函数</li><li>原型和原型链、作用域和闭包、异步</li><li>不能操作DOM，不能监听click事件，不能发送ajax请求</li><li>不能处理http请求，不能操作文件</li><li>即，只有ECMAScript，几乎做不不了任何实际的项目</li></ul></li><li>Javascript<ul><li>使用ECMAScript语法规范（ES标准），外加Web API（W3C标准），缺一不可</li><li>DOM操作，BOM操作，事件绑定，Ajax等</li><li>两者结合，即可完成浏览器端的任何操作</li><li>Nodejs = ECMAScript + Web API</li></ul></li><li>Nodejs<ul><li>使用ECMAScript语法规范，外加Nodejs API，缺一不可</li><li>处理http，处理文件等，具体可参考<a href="http://nodejs.cn/api/" target="_blank" rel="noopener">http://nodejs.cn/api/</a></li><li>两者结合，即可完成server端的任何操作</li><li>Nodejs = ECMAScript + Nodejs API</li></ul></li></ol></blockquote><p><strong>3）server开发和前端开发的区别？</strong></p><blockquote><ol><li>服务稳定性<ul><li>server端可能会遭受各种恶意攻击和误操作</li><li>单个客户端可以挂掉，但是服务器不能</li><li>使用PM2做进程守候</li></ul></li><li>考虑内存和CPU（优化，扩展）<ul><li>客户端独占一个浏览器，内存和CPU都不是问题</li><li>server端要承载很多请求，CPU和内存都是稀缺资源</li><li>使用stream写日志，使用redis存session</li></ul></li><li>日志记录<ul><li>前端也会参与写日志，但只是日志的发起方，不关心后续</li><li>server端要记录日志、存储日志、分析日志，前端不关心</li><li>多种日志记录方式，以及如何分析日志</li></ul></li><li>安全<ul><li>server端要随时准备接受各种恶意攻击，前端则少很多</li><li>如：越权操作，数据库攻击等</li><li>登录验证，预防XSS攻击和SQL注入</li></ul></li><li>集群和服务拆分<ul><li>产品发展速度快，流量可能会迅速增加</li><li>如何通过扩展机器和服务拆分来承载大流量？</li><li>这里虽然是单机开发，但是从设计上支持服务拆分</li></ul></li></ol></blockquote><h2 id="3-1-博客系统需求介绍"><a href="#3-1-博客系统需求介绍" class="headerlink" title="3.1 博客系统需求介绍"></a>3.1 博客系统需求介绍</h2><blockquote><ul><li>首页，作者主页，博客详情页</li><li>登录页</li><li>管理中心，新建页，编辑页</li></ul></blockquote><h2 id="3-2-1-技术方案"><a href="#3-2-1-技术方案" class="headerlink" title="3.2.1 技术方案"></a>3.2.1 技术方案</h2><blockquote><ol><li>数据如何存储（博客、用户）</li><li>如何与前端对接，即接口设计</li></ol></blockquote><p>博客表</p><table><thead><tr><th style="text-align:center">id</th><th style="text-align:center">title</th><th style="text-align:center">content</th><th style="text-align:center">createtime</th><th style="text-align:center">author</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">标题1</td><td style="text-align:center">内容1</td><td style="text-align:center">15436452645123</td><td style="text-align:center">zhangsan</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">标题2</td><td style="text-align:center">内容2</td><td style="text-align:center">15427676473647</td><td style="text-align:center">lisi</td></tr></tbody></table><p>用户表</p><table><thead><tr><th style="text-align:center">id</th><th style="text-align:center">username</th><th style="text-align:center">passworrd</th><th style="text-align:center">realname</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">zhangsan</td><td style="text-align:center">123</td><td style="text-align:center">张三</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">lisi</td><td style="text-align:center">123</td><td style="text-align:center">李四</td></tr></tbody></table><p>接口设计</p><table><thead><tr><th style="text-align:center">描述</th><th style="text-align:center">接口</th><th style="text-align:center">方法</th><th style="text-align:center">url参数</th><th style="text-align:center">备注</th></tr></thead><tbody><tr><td style="text-align:center">获取博客列表</td><td style="text-align:center">/api/blog/list</td><td style="text-align:center">get</td><td style="text-align:center">author作者，keyword搜索关键字</td><td style="text-align:center">参数为空的话，则不进行查询过滤</td></tr><tr><td style="text-align:center">获取一篇博客的内容</td><td style="text-align:center">/api/blog/detail</td><td style="text-align:center">get</td><td style="text-align:center">id</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">新增一篇博客</td><td style="text-align:center">/api/blog/new</td><td style="text-align:center">post</td><td style="text-align:center"></td><td style="text-align:center">post中有新增的信息</td></tr><tr><td style="text-align:center">更新一篇博客</td><td style="text-align:center">/api/blog/update</td><td style="text-align:center">post</td><td style="text-align:center">id</td><td style="text-align:center">postData中有更新的内容</td></tr><tr><td style="text-align:center">删除一篇博客</td><td style="text-align:center">/api/blog/del</td><td style="text-align:center">post</td><td style="text-align:center">id</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">登录</td><td style="text-align:center">/api/user/login</td><td style="text-align:center">post</td><td style="text-align:center"></td><td style="text-align:center">postData中有用户名和密码</td></tr></tbody></table><h2 id="3-2-2-关于登录"><a href="#3-2-2-关于登录" class="headerlink" title="3.2.2 关于登录"></a>3.2.2 关于登录</h2><ul><li>业界有统一的解决方案，一般不用再重新设计</li><li>实现起来比较复杂，课程后面会讲解</li></ul><h2 id="4-1-1-开发接口（不用任何框架）"><a href="#4-1-1-开发接口（不用任何框架）" class="headerlink" title="4.1.1 开发接口（不用任何框架）"></a>4.1.1 开发接口（不用任何框架）</h2><ul><li>nodejs处理http请求</li><li>搭建开发环境</li><li>开发接口（暂不连接数据库，暂不考虑登录）</li></ul><h2 id="4-1-2-http请求概述"><a href="#4-1-2-http请求概述" class="headerlink" title="4.1.2 http请求概述"></a>4.1.2 http请求概述</h2><ul><li>DNS解析，建立TCP连接（3次握手），发送http请求</li><li>server接收到http请求，处理，并返回</li><li>客户端收到返回的数据，处理数据（如渲染页面，执行js）</li></ul><h2 id="4-2-1-nodejs处理http请求"><a href="#4-2-1-nodejs处理http请求" class="headerlink" title="4.2.1 nodejs处理http请求"></a>4.2.1 nodejs处理http请求</h2><ul><li>get请求和querystring</li><li>post请求和postdata</li><li>路由</li></ul><h2 id="4-2-2简单示例"><a href="#4-2-2简单示例" class="headerlink" title="4.2.2简单示例"></a>4.2.2简单示例</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.end(<span class="string">'hello world'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">server.listen(<span class="number">8000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 然后浏览器访问 http://localhost:8000/</span></span><br></pre></td></tr></table></figure><h2 id="4-2-3-nodejs处理get请求"><a href="#4-2-3-nodejs处理get请求" class="headerlink" title="4.2.3 nodejs处理get请求"></a>4.2.3 nodejs处理get请求</h2><ul><li>get请求，即客户端要向server端获取数据，如查询博客列表</li><li>通过querystring来传递数据，如a.html?a=100&amp;b=200</li><li>浏览器直接访问，就发送get请求</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createSeerver(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'method:'</span>, req.method); <span class="comment">// GET</span></span><br><span class="line">  <span class="keyword">const</span> url = req.url; <span class="comment">// url</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'url:'</span>, url);</span><br><span class="line">  req.query =  querystring.parse(url.split(<span class="string">'?'</span>)[<span class="number">1</span>]); <span class="comment">// 解析 querystring</span></span><br><span class="line">  res.end(<span class="built_in">JSON</span>.stringify(req.query)); <span class="comment">// 将querystring 返回</span></span><br><span class="line">&#125;)</span><br><span class="line">server.listen(<span class="number">8000</span>);</span><br></pre></td></tr></table></figure><h2 id="4-3-1-nodejs处理post请求"><a href="#4-3-1-nodejs处理post请求" class="headerlink" title="4.3.1 nodejs处理post请求"></a>4.3.1 nodejs处理post请求</h2><ul><li>post请求，即客户端要向服务端传递数据，如新建博客</li><li>通过post data传递数据，后面会演示</li><li>浏览器无法直接模拟，需要手写js，或者使用postman</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server =  http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.method === <span class="string">'POST'</span>) &#123;</span><br><span class="line">    <span class="comment">// req 数据格式</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'req content-type:'</span>, req.headers[<span class="string">'content-type'</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 接收数据</span></span><br><span class="line">    <span class="keyword">let</span> postData = <span class="string">''</span>;</span><br><span class="line">    req.on(<span class="string">'data'</span>, chunk =&gt; &#123;</span><br><span class="line">      postData += chunk.toString();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    req.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'postData:'</span>, postData);</span><br><span class="line">      res.end(postData);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">4003</span>, ()=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Server is running on port 4003.'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="4-4-处理http请求的综合示例"><a href="#4-4-处理http请求的综合示例" class="headerlink" title="4.4 处理http请求的综合示例"></a>4.4 处理http请求的综合示例</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> method = req.method;</span><br><span class="line">  <span class="keyword">const</span> url = req.url;</span><br><span class="line">  <span class="keyword">const</span> path = url.split(<span class="string">'?'</span>)[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">const</span> query =  querystring.parse(url.split[<span class="string">'?'</span>][<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置返回格式 JSON</span></span><br><span class="line">  res.setHeader(<span class="string">'content-type'</span>, <span class="string">'application/json'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 返回</span></span><br><span class="line">  <span class="keyword">const</span> resData = &#123;</span><br><span class="line">    method,</span><br><span class="line">    utl,</span><br><span class="line">    path,</span><br><span class="line">    query</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (method === <span class="string">'GET'</span>) &#123;</span><br><span class="line">    res.end(<span class="built_in">JSON</span>.stringify(resData));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(method === <span class="string">'POST'</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> postData = <span class="string">''</span>;</span><br><span class="line">    req.on(<span class="string">'data'</span>, chunk =&gt; &#123;</span><br><span class="line">      postData += chunk.toString();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    req.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">      resData.postData = postData;</span><br><span class="line">      <span class="comment">// 返回</span></span><br><span class="line">      res.end(<span class="built_in">JSON</span>.stringify(resData));</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">4003</span>, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Server is running on port 4003.'</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="4-5-搭建开发环境"><a href="#4-5-搭建开发环境" class="headerlink" title="4.5 搭建开发环境"></a>4.5 搭建开发环境</h2><ul><li>从0开始搭建，不使用任何框架</li><li>使用nodemon监测文件变化，自动重启node</li><li>使用cross-env设置环境变量，兼容mac linux和windows</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为什么将www.js和app.js拆分开？目的是为了抽离，app.js主要是为了业务提供服务的一些业务代码，www.js是和server的技术有关系</span></span><br><span class="line"><span class="comment">// www.js</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PORT = <span class="number">4003</span>;</span><br><span class="line"><span class="keyword">const</span> serverHandle = <span class="built_in">require</span>(<span class="string">'../app'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> server= http.createServer(seerverHandle);</span><br><span class="line">server.listen(PORT, ()=&gt;&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Server is running on port 4003.'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> serverHandle = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 设置返回格式 JSON</span></span><br><span class="line">  res.setHeader(<span class="string">'content-type'</span>, <span class="string">'application/json'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> resData = &#123;</span><br><span class="line">    name: <span class="string">'木木'</span>，</span><br><span class="line">    site: <span class="string">'mumu'</span>,</span><br><span class="line">    env: process.env.NODE_ENV</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  res.end(<span class="built_in">JSON</span>.stringify(resData));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = serverHandle;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">  ...,</span><br><span class="line">  <span class="string">"script"</span>: &#123;</span><br><span class="line">    ...,</span><br><span class="line">    <span class="string">"dev"</span>: <span class="string">"cross-env NODE_ENV=dev node ./bin/www.js"</span>,</span><br><span class="line">    <span class="string">"prod"</span>: <span class="string">"cross-env NODE_DEV=production node ./bin/www.js"</span></span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-6-开发接口"><a href="#4-6-开发接口" class="headerlink" title="4.6 开发接口"></a>4.6 开发接口</h2><ul><li>初始化路由：根据之前技术方案的设计，做出路由</li><li>返回假数据：将路由和数据处理分离，以符合设计原则</li></ul><table><thead><tr><th style="text-align:center">描述</th><th style="text-align:center">接口</th><th style="text-align:center">方法</th><th style="text-align:center">url参数</th><th style="text-align:center">备注</th></tr></thead><tbody><tr><td style="text-align:center">获取博客列表</td><td style="text-align:center">/api/blog/list</td><td style="text-align:center">get</td><td style="text-align:center">author作者，keyword搜索关键字</td><td style="text-align:center">参数为空的话，则不进行查询过滤</td></tr><tr><td style="text-align:center">获取一篇博客的内容</td><td style="text-align:center">/api/blog/detail</td><td style="text-align:center">get</td><td style="text-align:center">id</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">新增一篇博客</td><td style="text-align:center">/api/blog/new</td><td style="text-align:center">post</td><td style="text-align:center"></td><td style="text-align:center">post中有新增的信息</td></tr><tr><td style="text-align:center">更新一篇博客</td><td style="text-align:center">/api/blog/update</td><td style="text-align:center">post</td><td style="text-align:center">id</td><td style="text-align:center">postData中有更新的内容</td></tr><tr><td style="text-align:center">删除一篇博客</td><td style="text-align:center">/api/blog/del</td><td style="text-align:center">post</td><td style="text-align:center">id</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">登录</td><td style="text-align:center">/api/user/login</td><td style="text-align:center">post</td><td style="text-align:center"></td><td style="text-align:center">postData中有用户名和密码</td></tr></tbody></table><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> handleBlogRouter = <span class="built_in">require</span>(<span class="string">'./src/router/blog'</span>);</span><br><span class="line"><span class="keyword">const</span> handleUserRouter = <span class="built_in">require</span>(<span class="string">'./src/router/user'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> serverHandle = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 设置返回格式 JSON</span></span><br><span class="line">  res.setHeader(<span class="string">'Content-type'</span>, <span class="string">'applicatiion/json'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取path</span></span><br><span class="line">  <span class="keyword">const</span> url = req.url;</span><br><span class="line">  <span class="keyword">const</span> path = url.split(<span class="string">'?'</span>)[<span class="number">0</span>];</span><br><span class="line">  req.path = path;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 处理 blog 路由</span></span><br><span class="line">  <span class="keyword">const</span> blogData = handleBlogRouter(req, res);</span><br><span class="line">  <span class="keyword">if</span>(blogData) &#123;</span><br><span class="line">    res.end(</span><br><span class="line">      <span class="built_in">JSON</span>.stringify(blogData)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 处理 user 路由</span></span><br><span class="line">  <span class="keyword">const</span> userData = handleUserRouter(req, res);</span><br><span class="line">  <span class="keyword">if</span>(userData) &#123;</span><br><span class="line">    res.end(</span><br><span class="line">      <span class="built_in">JSON</span>.stringify(userData)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 未命中路由，返回404</span></span><br><span class="line">  res.writeHead(<span class="number">404</span>, &#123;<span class="string">'Content-type'</span>, <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">  res.write(<span class="string">'404 Not Found\n'</span>);</span><br><span class="line">  res.end();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = serverHandle;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ./src/router/blog.js</span></span><br><span class="line"><span class="keyword">const</span> handleBlogRouter = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> method = req.method;</span><br><span class="line">  <span class="keyword">const</span> path = req.path;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取博客列表</span></span><br><span class="line">  <span class="keyword">if</span>(method === <span class="string">'GET'</span>&amp;&amp;path===<span class="string">'/api/blog/list'</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      msg: <span class="string">'这是一个获取博客列表的接口'</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = handleBlogRouter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ./src/router/user.js</span></span><br><span class="line"><span class="keyword">const</span> handleUserRouter = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> method = req.method;</span><br><span class="line">  <span class="keyword">const</span> path = req.path;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用户登录</span></span><br><span class="line">  <span class="keyword">if</span>(method === <span class="string">'GET'</span>&amp;&amp;path===<span class="string">'/api/user/login'</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      msg: <span class="string">'这是一个用户登录的接口'</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = handleUserRouter;</span><br></pre></td></tr></table></figure><h2 id="4-8-promise回忆"><a href="#4-8-promise回忆" class="headerlink" title="4.8 promise回忆"></a>4.8 promise回忆</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// callback 获取一个文件的内容</span></span><br><span class="line"><span class="comment">// const readFileContent = (filename, callBack) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   const fullFileName = path.resolve(__dirname, 'files', filename);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//   fs.readFile(fullFileName, (err, data) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     if (err) &#123;</span></span><br><span class="line"><span class="comment">//       console.log(err);</span></span><br><span class="line"><span class="comment">//       return;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     callBack(</span></span><br><span class="line"><span class="comment">//       JSON.parse(data.toString())</span></span><br><span class="line"><span class="comment">//     );</span></span><br><span class="line"><span class="comment">//   &#125;)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  测试 callback-hell</span></span><br><span class="line"><span class="comment">// readFileContent('a.json', aData =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log('a data:', aData);</span></span><br><span class="line"><span class="comment">//   readFileContent('b.json', bData =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     console.log('b data:', bData);</span></span><br><span class="line"><span class="comment">//     readFileContent('c.json', cData =&gt; &#123;</span></span><br><span class="line"><span class="comment">//       console.log('c data:', cData);</span></span><br><span class="line"><span class="comment">//     &#125;)</span></span><br><span class="line"><span class="comment">//   &#125;);</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// promise 获取文件内容</span></span><br><span class="line"><span class="keyword">const</span> readFileContent = <span class="function">(<span class="params">filename</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> fullFileName = path.resolve(__dirname, <span class="string">'files'</span>, filename);</span><br><span class="line">    fs.readFile(fullFileName, (err, data) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        reject(err);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      resolve(</span><br><span class="line">        <span class="built_in">JSON</span>.parse(data.toString())</span><br><span class="line">      );</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> promise;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">readFileContent(<span class="string">'a.json'</span>)</span><br><span class="line">  .then(<span class="function"><span class="params">aData</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'a data:'</span>, aData);</span><br><span class="line">    <span class="keyword">return</span> readFileContent(aData.next);</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">bData</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'b data:'</span>, bData);</span><br><span class="line">    <span class="keyword">return</span> readFileContent(bData.next);</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">cData</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'c data:'</span>, cData);</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><h2 id="4-9-开发路由（处理POSTData）"><a href="#4-9-开发路由（处理POSTData）" class="headerlink" title="4.9 开发路由（处理POSTData）"></a>4.9 开发路由（处理POSTData）</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handleBlogRouter = <span class="built_in">require</span>(<span class="string">'./src/router/blog'</span>);</span><br><span class="line"><span class="keyword">const</span> handleUserRouter = reuqire(<span class="string">'./srcc/router/user'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getPostData = <span class="function">(<span class="params">req</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span>(req.method!==<span class="string">'POST'</span>)&#123;</span><br><span class="line">    resolve(&#123;&#125;);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(req.headers[<span class="string">'content-type'</span>]!==<span class="string">'application/json'</span>)&#123;</span><br><span class="line">    resolve(&#123;&#125;);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> postData = <span class="string">''</span>;</span><br><span class="line">  req.on(<span class="string">'data'</span>, chunk =&gt; &#123;</span><br><span class="line">    postData += chunk.toString();</span><br><span class="line">  &#125;);</span><br><span class="line">  req.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span>(!postData) &#123;</span><br><span class="line">      resolve(&#123;&#125;);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    resolve(</span><br><span class="line">      <span class="built_in">JSON</span>.parse(postData);</span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> serverHandle = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 设置返回格式 JSON</span></span><br><span class="line">  res.setHeader(&#123;<span class="string">'Content-type'</span>, <span class="string">'application/json'</span>&#125;);</span><br><span class="line">  <span class="comment">// 处理 path</span></span><br><span class="line">  <span class="keyword">const</span> method = req.method;</span><br><span class="line">  <span class="keyword">const</span> url = req.url;</span><br><span class="line">  req.path = url.split(<span class="string">'?'</span>)[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 处理 query</span></span><br><span class="line">  req.query =  querystring.parse(url.split(<span class="string">'?'</span>)[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 处理 postData</span></span><br><span class="line">  getPostData().then(<span class="function"><span class="params">postData</span> =&gt;</span> &#123;</span><br><span class="line">    req.body = postData;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理 blog 路由</span></span><br><span class="line">    <span class="keyword">const</span> blogData = handleBlogRouter(req, res);</span><br><span class="line">    <span class="keyword">if</span>(blogData) &#123;</span><br><span class="line">      res.end(</span><br><span class="line">        <span class="built_in">JSON</span>.stringify(blogData)</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理 user 路由</span></span><br><span class="line">    <span class="keyword">const</span> userData = handleUserRouter(req, res);</span><br><span class="line">    <span class="keyword">if</span>(userData) &#123;</span><br><span class="line">      res.end(</span><br><span class="line">        <span class="built_in">JSON</span>.stringify(userData);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 未命中路由</span></span><br><span class="line">    res.writeHead(<span class="number">404</span>, &#123;<span class="string">'Content-type'</span>, <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">    res.write(<span class="string">'404 Not Found\n'</span>);</span><br><span class="line">    res.end;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports serverHandle;</span><br></pre></td></tr></table></figure><h2 id="4-11总结"><a href="#4-11总结" class="headerlink" title="4.11总结"></a>4.11总结</h2><ul><li>nodejs处理http请求的常用技能，使用postman</li><li>nodejs开发博客项目的接口（未连接数据库，未使用登录）</li><li>为何要将router和controller分开？</li></ul><p>完整示例如下：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ./src/router/blog.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; SuccessModel, ErrorModel &#125; = <span class="built_in">require</span>(<span class="string">'../model/resModel'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; getList, getDetail, newBlog, updateBlog, deleteBlog &#125; = <span class="built_in">require</span>(<span class="string">'../controller/blog'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> handleBlogRouter = <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> method = req.method; <span class="comment">// GET POST</span></span><br><span class="line">  <span class="keyword">const</span> path = req.path;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> id = req.query.id;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取博客列表</span></span><br><span class="line">  <span class="keyword">if</span> (method === <span class="string">'GET'</span> &amp;&amp; path === <span class="string">'/api/blog/list'</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> author = req.query.author || <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">const</span> keyword = req.query.keyword || <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">const</span> listData = getList(author, keyword);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SuccessModel(listData);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取博客详情</span></span><br><span class="line">  <span class="keyword">if</span> (method === <span class="string">'GET'</span> &amp;&amp; path === <span class="string">'/api/blog/detail'</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> data = getDetail(id);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SuccessModel(data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 新建一篇博客</span></span><br><span class="line">  <span class="keyword">if</span> (method === <span class="string">'POST'</span> &amp;&amp; path === <span class="string">'/api/blog/new'</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> blogData = req.body;</span><br><span class="line">    <span class="keyword">const</span> data = newBlog(blogData);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SuccessModel(data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 更新一篇博客</span></span><br><span class="line">  <span class="keyword">if</span> (method === <span class="string">'POST'</span> &amp;&amp; path === <span class="string">'/api/blog/update'</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = updateBlog(id, req.body);</span><br><span class="line">    <span class="keyword">if</span> (result) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SuccessModel();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> ErrorModel(<span class="string">'更新博客失败'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 删除一篇博客</span></span><br><span class="line">  <span class="keyword">if</span> (method === <span class="string">'POST'</span> &amp;&amp; path === <span class="string">'/api/blog/delete'</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = deleteBlog(id);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (result) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SuccessModel();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ErrorModel(<span class="string">'删除博客失败'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = handleBlogRouter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ./src/controller/blog.js</span></span><br><span class="line"><span class="keyword">const</span> getList = <span class="function">(<span class="params">author, keyword</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 先返回假数据（格式是正确的）</span></span><br><span class="line">  <span class="keyword">return</span> [</span><br><span class="line">    &#123;</span><br><span class="line">      id: <span class="number">1</span>,</span><br><span class="line">      title: <span class="string">'标题A'</span>,</span><br><span class="line">      content: <span class="string">'内容A'</span>,</span><br><span class="line">      createTime: <span class="number">1558664497766</span>,</span><br><span class="line">      author: <span class="string">'zhangsan'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      id: <span class="number">2</span>,</span><br><span class="line">      title: <span class="string">'标题B'</span>,</span><br><span class="line">      content: <span class="string">'内容B'</span>,</span><br><span class="line">      createTime: <span class="number">1558664555616</span>,</span><br><span class="line">      author: <span class="string">'lisi'</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getDetail = <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 先返回假数据</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    id: <span class="number">1</span>,</span><br><span class="line">    title: <span class="string">'标题A'</span>,</span><br><span class="line">    content: <span class="string">'内容A'</span>,</span><br><span class="line">    createTime: <span class="number">1558664497766</span>,</span><br><span class="line">    author: <span class="string">'zhangsan'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newBlog = <span class="function">(<span class="params">blogData = &#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// blogData 是一个博客对象，包含 title content 属性</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'newBlog blogData...'</span>, blogData);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    id: <span class="number">3</span> <span class="comment">// 表示新建博客，插入到数据库表里面的 id</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> updateBlog = <span class="function">(<span class="params">id, blogData = &#123;&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// blogData 是一个博客对象，包含title content 属性</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'update blog...'</span>, id, blogData);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> deleteBlog = <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// id 是删除博客的id</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'deleteBlog id:'</span>, id);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  getList,</span><br><span class="line">  getDetail,</span><br><span class="line">  newBlog,</span><br><span class="line">  updateBlog,</span><br><span class="line">  deleteBlog</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><h2 id="4-12-路由和API"><a href="#4-12-路由和API" class="headerlink" title="4.12 路由和API"></a>4.12 路由和API</h2><ul><li>API:<br>前端和后端、不同端（子系统）之间对接的一个术语<br>url（路由）<code>/api/blog/list</code> get，输入，输出</li><li>路由：<br>API的一部分<br>后端系统内部的一个模块</li></ul><hr><div class="post-announce">感谢您的阅读，本文由 <a href="http://yoursite.com">MUMU</a> 版权所有。如若转载，请注明出处：MUMU（<a href="http://yoursite.com/2019/04/29/hello-nodejs1/">http://yoursite.com/2019/04/29/hello-nodejs1/</a>）</div><div class="post__prevs"><div class="post__prev"><a href="/2018/05/29/hello-redux/" title="Redux入门"><i class="iconfont icon-prev"></i>Redux入门</a></div><div class="post__prev post__prev--right"><a href="/2019/05/24/hello-nodejs2/" title="Node.js开发博客项目（二）">Node.js开发博客项目（二）<i class="iconfont icon-next"></i></a></div></div></div></article></div><aside class="page__sidebar"><form id="page-search-from" class="page__search-from" action="/search/"><label class="search-form__item"><input class="input" type="text" name="search" placeholder="Search..."> <i class="iconfont icon-search"></i></label></form><div class="sidebar__block"><h3 class="block__title">简介</h3><p class="block__text">日常学习与兴趣交流的个人博客。</p></div><div class="sidebar__block"><h3 class="block__title">文章分类</h3><ul class="block-list"><li class="block-list-item"><a class="block-list-link" href="/categories/前端/">前端</a><span class="block-list-count">4</span></li></ul></div><div class="sidebar__block"><h3 class="block__title">最新文章</h3><ul class="block-list latest-post-list"><li class="latest-post-item"><a href="/2019/05/24/hello-nodejs2/" title="Node.js开发博客项目（二）"><div class="item__cover"><img src="/img/nodejs_mysql.png" alt="Node.js开发博客项目（二）"></div><div class="item__info"><h3 class="item__title">Node.js开发博客项目（二）</h3><span class="item__text">2019-05-24</span></div></a></li><li class="latest-post-item"><a href="/2019/04/29/hello-nodejs1/" title="Node.js开发博客项目（一）"><div class="item__cover"><img src="/img/nodejs.png" alt="Node.js开发博客项目（一）"></div><div class="item__info"><h3 class="item__title">Node.js开发博客项目（一）</h3><span class="item__text">2019-04-29</span></div></a></li><li class="latest-post-item"><a href="/2018/05/29/hello-redux/" title="Redux入门"><div class="item__cover"><img src="/img/react_redux.jpg" alt="Redux入门"></div><div class="item__info"><h3 class="item__title">Redux入门</h3><span class="item__text">2018-05-29</span></div></a></li><li class="latest-post-item"><a href="/2018/03/09/hello-hexo/" title="Hexo 快速搭建博客"><div class="item__cover"><img src="/img/hexo_github.jpg" alt="Hexo 快速搭建博客"></div><div class="item__info"><h3 class="item__title">Hexo 快速搭建博客</h3><span class="item__text">2018-03-09</span></div></a></li></ul></div><div class="sidebar__block"><h3 class="block__title">文章标签</h3><ul class="block-list tag-list clearfix"><li class="tag-item"><a class="tag-link" href="/tags/Hexo/">Hexo</a></li><li class="tag-item"><a class="tag-link" href="/tags/Node-js/">Node.js</a></li><li class="tag-item"><a class="tag-link" href="/tags/React-Redux/">React Redux</a></li></ul></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--2"><h3 class="item__title">关于</h3><div class="item__content"><p class="item__text">本站是基于 Hexo 搭建的静态资源博客，主要用于分享日常学习、生活及工作的一些心得总结，欢迎点击右下角订阅 rss。</p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span>Hangzhou, Zhejiang Province, China</span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span>groot01@163.com</span></li></ul></div></div><div class="footer-top__item"><h3 class="item__title">友情链接</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://github.com/Mrminfive/hexo-theme-skapp" title="hexo-theme-skapp" target="_blank">hexo-theme-skapp</a></li><li class="list-item"><a href="https://juejin.im/welcome/frontend" title="掘金" target="_blank">掘金</a></li><li class="list-item"><a href="https://segmentfault.com/channel/frontend" title="segmentfault" target="_blank">segmentfault</a></li><li class="list-item"><a href="https://www.w3cplus.com/blog/html-and-css" title="w3cplus - 大漠" target="_blank">w3cplus - 大漠</a></li></ul></div></div><div class="footer-top__item"><h3 class="item__title">构建工具</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://hexo.io/" title="Blog Framework" target="_blank">Hexo</a></li></ul></div></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">© <a href="https://github.com/Mrminfive/hexo-theme-skapp" target="_blank">Skapp</a> 2017 powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, made by <a href="https://github.com/Mrminfive" target="_blank">minfive</a>.</p><ul class="footer__social-network clearfix"><li class="social-network__item"><a href="https://github.com/bbgirl01" target="_blank" title="github"><i class="iconfont icon-github"></i></a></li><li class="social-network__item"><a href="mailto:groot01@163.com" target="_blank" title="email"><i class="iconfont icon-email"></i></a></li><li class="social-network__item"><a href="https://www.zhihu.com/people/zhang-fang-fang-76-3/activities" target="_blank" title="rss"><i class="iconfont icon-zhihu"></i></a></li></ul></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>